<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ creator.display_name or 'Unknown' }} - Quiz Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">Quiz Management System</h1>
            <div>
                <a href="{{ url_for('dashboard') }}" class="mx-2 hover:text-blue-200">Dashboard</a>
                <a href="{{ url_for('creators') }}" class="mx-2 hover:text-blue-200">Creators</a>
                <a href="{{ url_for('quizzes') }}" class="mx-2 hover:text-blue-200">Quizzes</a>
                <a href="{{ url_for('attempts') }}" class="mx-2 hover:text-blue-200">Attempts</a>
                <a href="{{ url_for('logout') }}" class="mx-2 hover:text-blue-200">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <div class="mb-6">
            <a href="{{ url_for('creators') }}" class="text-blue-600 hover:text-blue-800 mb-4 inline-block">‚Üê Back to Creators</a>
            <h2 class="text-3xl font-bold text-gray-800">Creator Details</h2>
        </div>

        <!-- Creator Info -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h3 class="text-xl font-semibold mb-4">Creator Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p><strong>ID:</strong> {{ creator['id'] }}</p>
                    <p><strong>Telegram User ID:</strong> {{ creator['tg_user_id'] }}</p>
                    <p><strong>Username:</strong> @{{ creator['username'] or 'Not set' }}</p>
                </div>
                <div>
                    <p><strong>Display Name:</strong> {{ creator['display_name'] or 'Not set' }}</p>
                    <p><strong>Admin Status:</strong> 
                        {% if creator['is_admin'] %}
                        <span class="text-green-600 font-semibold">Admin</span>
                        {% else %}
                        <span class="text-gray-600">User</span>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Creator's Quizzes -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h3 class="text-xl font-semibold mb-4">Quizzes Created ({{ quizzes|length }})</h3>
            {% if quizzes %}
            <div class="space-y-4">
                {% for quiz in quizzes %}
                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start">
                        <div>
                            <a href="{{ url_for('quiz_detail', quiz_id=quiz['id']) }}" 
                               class="text-lg font-semibold text-blue-600 hover:text-blue-800">
                                {{ quiz['title'] }}
                            </a>
                            <p class="text-sm text-gray-600">ID: {{ quiz['id'] }}</p>
                            <p class="text-sm text-gray-600">{{ quiz['question_count'] }} questions</p>
                            <p class="text-sm text-gray-500">Created: {{ quiz['created_at'][:16] }}</p>
                        </div>
                        <div class="flex space-x-2">
                            <a href="{{ url_for('quiz_detail', quiz_id=quiz['id']) }}" 
                               class="bg-blue-500 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                View
                            </a>
                            <button onclick="deleteQuiz('{{ quiz['id'] }}')" 
                                    class="bg-red-500 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-600">No quizzes created yet.</p>
            {% endif %}
        </div>

        <!-- Recent Attempts -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold mb-4">Recent Quiz Attempts</h3>
            {% if attempts %}
            <div class="space-y-3">
                {% for attempt in attempts %}
                <div class="border-b pb-3">
                    <a href="{{ url_for('attempt_detail', attempt_id=attempt['id']) }}" 
                       class="font-semibold text-blue-600 hover:text-blue-800">
                        {{ attempt['quiz_title'] }}
                    </a>
                    <p class="text-sm text-gray-600">
                        User: {{ attempt['username'] or attempt['user_id'] }}
                        {% if attempt['score'] is not none %}
                        - Score: {{ "%.2f"|format(attempt['score']) }}/{{ attempt['max_score'] }}
                        {% endif %}
                    </p>
                    <p class="text-xs text-gray-500">{{ attempt['started_at'][:16] }}</p>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-gray-600">No attempts found for this creator's quizzes.</p>
            {% endif %}
        </div>
    </div>

    <script>
    function deleteQuiz(quizId) {
        if (confirm('Are you sure you want to delete this quiz? This action cannot be undone.')) {
            fetch(`/delete_quiz/${quizId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Quiz deleted successfully');
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error deleting quiz: ' + error);
            });
        }
    }
    </script>
</body>
</html>
